<?php
namespace App\Services\Astar;
use App\Services\Astar\SkorWarung;

class Graph2{
    
    public static function Haversine($lat1, $lon1, $lat2, $lon2)
    {
        $earthRadius = 6371;

        $dlat = deg2rad($lat2 - $lat1);
        $dlon = deg2rad($lon2 - $lon1);

        $a = sin($dlat / 2) * sin($dlat / 2) +
            cos(deg2rad($lat1)) * cos(deg2rad($lat2)) *
            sin($dlon / 2) * sin($dlon / 2);

        $c = 2 * atan2(sqrt($a), sqrt(1 - $a));
        return $earthRadius * $c;
    }


    public static function buildgraph(){
        $nodes = [
            'user' => ['lat'=> -7.558067551108021, 'lng'=>110.85081864147803],
            'A'=>['lat' => -7.558171325412684, 'lng' => 110.85096008893123],
            'B'=>['lat' => -7.558070286992826, 'lng' => 110.85064358826126],
            'C'=>['lat' => -7.558155371979529, 'lng' => 110.85120685216542],
            'D'=>['lat' => -7.558006473241808, 'lng' => 110.8505362998986],
            'E'=>['lat' => -7.558644610327727, 'lng' => 110.85119075891102],
            'F'=>['lat' => -7.558272363808879, 'lng' => 110.8504021894452],
            'G'=>['lat' => -7.558314906284426, 'lng' => 110.8502627145737],
            'H'=>['lat' => -7.558421262454924, 'lng' => 110.85055239315297],
            'I'=>['lat' => -7.558501029565623, 'lng' => 110.85070259686076],
            'J'=>['lat' => -7.558538254212228, 'lng' => 110.85078306313278],
            'K'=>['lat' => -7.558607385690283, 'lng' => 110.85089035149548],
            'L'=>['lat' => -7.558628656912077, 'lng' => 110.85104055520326],
            'M'=>['lat' => -7.558639292522574, 'lng' => 110.85127658960118],
            'N'=>['lat' => -7.558708423984446, 'lng' => 110.85181303141465],
            'O'=>['lat' => -7.5586658815476895, 'lng' => 110.85231728671594],
            'P'=>['lat' => -7.559101941325839, 'lng' => 110.8523441088066],
            'Q'=>['lat' => -7.559155119317445, 'lng' => 110.85249967693252],
            'R'=>['lat' => -7.559319971049773, 'lng' => 110.85255868553202],
            'S'=>['lat' => -7.55949014051391, 'lng' => 110.85258550762269],
            'T'=>['lat' => -7.559607131981593, 'lng' => 110.85262842296775],
            'U'=>['lat' => -7.55972412341756, 'lng' => 110.85262305854963],
            'V'=>['lat' => -7.559798572496691, 'lng' => 110.85269816039083],
            'W'=>['lat' => -7.560117639833196, 'lng' => 110.85259623644627],
            'X'=>['lat' => -7.560606875957816, 'lng' => 110.85219390508617],
            'Y'=>['lat' => -7.561056116128262, 'lng' => 110.85178539774836],
            'Z'=>['lat' => -7.56134941436885, 'lng' => 110.85155780476461],
            'AA'=>['lat' => -7.561605110105394, 'lng' => 110.85138711002892],
            'AB'=>['lat' => -7.561785601120837, 'lng' => 110.85107227306437],
            'AC'=>['lat' => -7.561849525004043, 'lng' => 110.85079536826424],
            'AD'=>['lat' => -7.561815682949401, 'lng' => 110.85053363632986],
            'AE'=>['lat' => -7.561257219465788, 'lng' => 110.85053681756469],
            'AF'=>['lat' => -7.561347031546174, 'lng' => 110.85103919399164],
            'AG'=>['lat' => -7.561121325489842, 'lng' => 110.8510587960838],
            'AH'=>['lat' => -7.5612199784826215, 'lng' => 110.85136790599871],
            'AI'=>['lat' => -7.560537860419936, 'lng' => 110.85084088426039],
            'AJ'=>['lat' => -7.560856680602037, 'lng' => 110.85050501836533],
            'AK'=>['lat' => -7.560866345229888, 'lng' => 110.85026800632292],
            'AL'=>['lat' => -7.56100218772329, 'lng' => 110.85025054121265],
            'AM'=>['lat' => -7.560767792805955, 'lng' => 110.85009604216006],
            'AN'=>['lat' => -7.560857022704267, 'lng' => 110.8500261817189],
            'AO'=>['lat' => -7.561099408305064, 'lng' => 110.85005036417931],
            'AP'=>['lat' => -7.561168661308868, 'lng' => 110.8499052694169],
            'AQ'=>['lat' => -7.561742661748287, 'lng' => 110.85006514234995],
            'AR'=>['lat' => -7.561062118230176, 'lng' => 110.84985824796651],
            'AS'=>['lat' => -7.560963565850935, 'lng' => 110.8497857005853],
            'AT'=>['lat' => -7.560803751125691, 'lng' => 110.84984884367798],
            'AU'=>['lat' => -7.560441575194282, 'lng' => 110.8499251663826],
            'AV'=>['lat' => -7.560428904994559, 'lng' => 110.85042683291293],
            'AW'=>['lat' => -7.560137490298364, 'lng' => 110.85044280955405],
            'AX'=>['lat' => -7.560083641904836, 'lng' => 110.84989960375538],
            'AY'=>['lat' => -7.559918929142901, 'lng' => 110.84983250186278],
            'AZ'=>['lat' => -7.559868248280434, 'lng' => 110.8500082449148],
            'BA'=>['lat' => -7.559953772232397, 'lng' => 110.84962480552855],
            'BB'=>['lat' => -7.55953248741631, 'lng' => 110.84969190742116],
            'BC'=>['lat' => -7.559370941991549, 'lng' => 110.84970468874],
            'BD'=>['lat' => -7.559142877774117, 'lng' => 110.8497366420222],
            'BE'=>['lat' => -7.55892748366823, 'lng' => 110.84983569719724],
            'BF'=>['lat' => -7.558797613648029, 'lng' => 110.84983889252544],
            'BG'=>['lat' => -7.55857588425494, 'lng' => 110.84981972055613],
            'BH'=>['lat' => -7.558430176306073, 'lng' => 110.8497973532586],
            'BI'=>['lat' => -7.5583636574434925, 'lng' => 110.85001144024925],
            'BJ'=>['lat' => -7.558813451456431, 'lng' => 110.85070482645641],
            'BK'=>['lat' => -7.558902143178531, 'lng' => 110.85065689653312],
            'BL'=>['lat' => -7.558917980984135, 'lng' => 110.85056742734301],
            'BM'=>['lat' => -7.558835624388671, 'lng' => 110.85029901977262],
            'BN'=>['lat' => -7.559133375084704, 'lng' => 110.85016481599106],
            'BO'=>['lat' => -7.559434293130607, 'lng' => 110.85019996460146],
            'BP'=>['lat' => -7.559649686971516, 'lng' => 110.850222331899],
            'BQ'=>['lat' => -7.559918929121528, 'lng' => 110.85034694969953],
            'BR'=>['lat' => -7.559213327105258, 'lng' => 110.85063462236513],
            'BS'=>['lat' => -7.558984661725741, 'lng' => 110.85113351325168],
            'BT'=>['lat' => -7.5593994499991926, 'lng' => 110.85059707143822],
            'BU'=>['lat' => -7.559752765101613, 'lng' => 110.85072342329958],
            'BV'=>['lat' => -7.559731493935212, 'lng' => 110.85096482211566],
            'BW'=>['lat' => -7.560008019016772, 'lng' => 110.85119549209544],
            'BX'=>['lat' => -7.56011437477021, 'lng' => 110.8512920516219],
            'BY'=>['lat' => -7.560284543921214, 'lng' => 110.85150126392915],
            'BZ'=>['lat' => -7.560071832471971, 'lng' => 110.85160855229182],
            'CA'=>['lat' => -7.559880392078053, 'lng' => 110.8512920516219],
            'CB'=>['lat' => -7.559534735596234, 'lng' => 110.85132960254883],
            'CC'=>['lat' => -7.559157172046024, 'lng' => 110.8513403313851],
            'CD'=>['lat' => -7.5591252652520025, 'lng' => 110.85187677319857],
            'CE'=>['lat' => -7.5595081466246405, 'lng' => 110.85194114621619],
            'CF'=>['lat' => -7.559933569971902, 'lng' => 110.85193041736775],
            'CG'=>['lat' => -7.559992065649619, 'lng' => 110.85209671432992],
            'CH'=>['lat' => -7.560178188207813, 'lng' => 110.85205916340298],
            'CI'=>['lat' => -7.560327086196603, 'lng' => 110.85192505294961],
            'CJ'=>['lat' => -7.560156917062377, 'lng' => 110.85179630691437],
            'CK'=>['lat' => -7.560842910985994, 'lng' => 110.85009042196272],
            'CL'=>['lat' => -7.559353930566281, 'lng' => 110.85065905028502],
            'CM'=>['lat' => -7.55919439664529, 'lng' => 110.85116867000784],
            'CN'=>['lat' => -7.5604431725052805, 'lng' => 110.85050936889776],
            'warung'=>['lat' => -7.5614167, 'lng' =>  110.8506111],
        ];
        
        $edges= [];
        
        $connection = [
            ['user', 'A', 9],
            ['user', 'B', 8],
            ['A', 'C', 9],
            ['B', 'D', 8],
            ['C', 'E', 7],
            ['D', 'F', 7],
            ['E', 'M', 7],
            ['F', 'G', 8],
            ['F', 'H', 8],
            ['G', 'BI', 9],
            ['H', 'I', 8],
            ['I', 'J', 8],
            ['J', 'K', 7],
            ['J', 'BJ', 7],
            ['K', 'L', 8],
            ['L', 'E', 7],
            ['M', 'N', 8],
            ['M', 'CC', 9],
            ['N', 'O', 7],
            ['N', 'CD', 8],
            ['O', 'P', 7],
            ['P', 'Q', 7],
            ['P', 'CD', 6],
            ['Q', 'R', 8],
            ['R', 'S', 8],
            ['S', 'T', 7],
            ['T', 'U', 7],
            ['T', 'CE', 6],
            ['U', 'V', 7],
            ['V', 'W', 8],
            ['W', 'X', 7],
            ['W', 'CG', 7],
            ['X', 'CI', 7],
            ['X', 'Y', 8],
            ['Y', 'Z', 8],
            ['Y', 'AI', 5],
            ['Z', 'AA', 8],
            ['Z', 'AH', 7],
            ['AA', 'AB', 7],
            ['AA', 'AF', 7],
            ['AB', 'AC', 7],
            ['AC', 'AD', 8],
            ['AD', 'warung', 6],
            ['AE', 'warung', 6],
            ['AE', 'AF', 7],
            ['AE', 'AJ', 7],
            ['AF', 'AG', 7],
            ['AI', 'BW', 8],
            ['AI', 'CN', 8],
            ['AJ', 'AK', 7],
            ['AJ', 'CN', 7],
            ['AK', 'AL', 8],
            ['AK', 'CK', 7],
            ['AL', 'AO', 7],
            ['AM', 'CK', 5],
            ['AN', 'CK', 7],
            ['AO', 'AN', 7],
            ['AO', 'AP', 7],
            ['AP', 'AQ', 8],
            ['AP', 'AR', 8],
            ['AQ', 'AD', 7],
            ['AR', 'AS', 8],
            ['AS', 'AT', 7],
            ['AT', 'AU', 8],
            ['AU', 'AV', 7],
            ['AU', 'AX', 8],
            ['AV', 'AW', 7],
            ['AV', 'CN', 8],
            ['AX', 'AY', 8],
            ['AX', 'BQ', 8],
            ['AY', 'AZ', 7],
            ['AY', 'BA', 7],
            ['AY', 'BB', 8],
            ['BB', 'BC', 7],
            ['BB', 'BO', 7],
            ['BC', 'BD', 8],
            ['BD', 'BE', 7],
            ['BE', 'BF', 8],
            ['BF', 'BG', 8],
            ['BG', 'BH', 8],
            ['BH', 'BI', 8],
            ['BJ', 'BK', 8],
            ['BK', 'BL', 7],
            ['BL', 'BM', 7],
            ['BM', 'BN', 7],
            ['BN', 'BO', 8],
            ['BO', 'BP', 7],
            ['BO', 'BT', 8],
            ['BP', 'BQ', 7],
            ['BQ', 'BU', 8],
            ['BR', 'CL', 7],
            ['BS', 'CM', 8],
            ['BT', 'CL', 8],
            ['BT', 'BU', 7],
            ['BU', 'BV', 8],
            ['BV', 'BW', 8],
            ['BW', 'BX', 7],
            ['BW', 'CA', 7],
            ['BY', 'BZ', 8],
            ['BZ', 'CJ', 8],
            ['CA', 'CB', 8],
            ['CB', 'CC', 7],
            ['CB', 'CE', 8],
            ['CC', 'CD', 8],
            ['CD', 'CE', 7],
            ['CE', 'CF', 7],
            ['CF', 'CG', 8],
            ['CF', 'CJ', 7],
            ['CG', 'CH', 7],
            ['CH', 'CI', 7],
            ['CI', 'CJ', 6],
        ];



        foreach ($connection as [$from, $to, $rating]) {
            $lat1 = $nodes[$from]['lat'];
            $lng1 = $nodes[$from]['lng'];
            $lat2 = $nodes[$to]['lat'];
            $lng2 = $nodes[$to]['lng'];

            $jarak = self::Haversine($lat1, $lng1, $lat2, $lng2);
            $pinalti = 1 + ((10 - $rating)/10);
            $cost = $jarak * $pinalti;
            $edges[] = ['from' => $from, 'to' => $to, 'cost' => $cost];
        }

        return [
            'nodes' => $nodes,
            'edges' => $edges
        ];
    }

}

?>